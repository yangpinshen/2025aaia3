// LeetCode 3. Roman to Integer (ç¾…é¦¬æ•¸å­—è½‰æ•´æ•¸)
class Solution {
private:
    // Helper å‡½å¼ï¼šå°‡ç¾…é¦¬ç¬¦è™Ÿè½‰æ›æˆå°æ‡‰çš„æ•¸å€¼
    int helper(char c) { // æŠŠ1å€‹å­—æ¯ï¼Œè®Šæˆ1å€‹æ•¸å­—
        if (c == 'I') return 1;
        if (c == 'V') return 5;
        if (c == 'X') return 10;
        if (c == 'L') return 50;
        if (c == 'C') return 100;
        if (c == 'D') return 500;
        if (c == 'M') return 1000;
        return 0; // é‡åˆ°ç„¡æ•ˆå­—å…ƒæ™‚è¿”å› 0
    }

public:
    int romanToInt(string s) {
        int total = 0;
        int prev = 0; // å„²å­˜å‰ä¸€å€‹ç¾…é¦¬æ•¸å­—çš„å€¼

        // å¾å³åˆ°å·¦æˆ–å¾å·¦åˆ°å³éƒ½å¯ä»¥ï¼Œé€™è£¡æˆ‘å€‘æ¡ç”¨å·¦åˆ°å³ï¼Œä½†éœ€åˆ¤æ–·ç›¸é„°é—œä¿‚
        // ç‚ºäº†ä½¿ç”¨æˆªåœ–ä¸­çš„é‚è¼¯ï¼Œæˆ‘å€‘ä½¿ç”¨ã€Œprevã€å’Œã€Œnowã€è®Šæ•¸çš„æ€ç¶­ã€‚

        for (int i = 0; i < s.length(); i++) {
            // 1. å–å¾—ç•¶å‰å­—å…ƒçš„å€¼ (now)
            int now = helper(s[i]); // ç¾åœ¨çš„æ•¸å­—

            // 2. åˆ¤æ–·æ˜¯å¦ç‚ºæ¸›æ³•çµ„åˆ
            // é‚è¼¯ï¼šå¦‚æœå‰ä¸€å€‹æ•¸å­—çš„å€¼ < ç¾åœ¨é€™å€‹æ•¸å­—çš„å€¼ï¼Œ
            // å‰‡å‰ä¸€å€‹æ•¸å­—å°±æ˜¯ç”¨ä¾†åšæ¸›æ³•çš„ï¼Œæ‡‰è©²è¢«æ¸›å»å…©æ¬¡ (å› ç‚ºå‰é¢è¢«åŠ äº†ä¸€æ¬¡)
            if (prev < now) {
                // å¦‚æœå‰ä¸€å€‹å°æ–¼ç¾åœ¨é€™å€‹ (å¦‚ IX, I < X)
                // å¿…é ˆæ¸›å»å‰ä¸€å€‹æ•¸å€¼ * 2
                // total åŸæœ¬æ˜¯ total + prevï¼Œç¾åœ¨è¦ total - prev
                // total = total - prev + now - prev;
                total = total - prev * 2 + now; // éŒ¯èª¤ï¼Œæ­¤é‚è¼¯ä¸é©ç”¨æ–¼å¾å·¦åˆ°å³éæ­·
            } else {
                // å¦‚æœå‰ä¸€å€‹å¤§æ–¼æˆ–ç­‰æ–¼ç¾åœ¨é€™å€‹ (å¦‚ VI, V >= I)
                // å‰‡ç›´æ¥ç›¸åŠ 
                total += now;
            }

            // 3. æ›´æ–° prev
            prev = now;
        }

        // ğŸš¨ è¨»è§£ï¼šæˆªåœ–ä¸­çš„é‚è¼¯æ˜¯éŒ¯èª¤çš„æˆ–ä¸å®Œæ•´çš„ã€‚
        // æˆªåœ–ä¸­çš„è¨»è§£ï¼š
        // prev = now; // ç¾åœ¨è®Šæˆå‰ä¸€å€‹æ•¸å­—
        // now = helper(s[i]); // ç¾åœ¨çš„æ•¸å­—
        // if (prev < now) total = total - prev + now; // å‰æ•¸å€¼å°æ–¼å¾Œæ•¸å€¼ï¼ŒåŠ æ¸›å…©æ¬¡prev
        // else total += now;

        // ***æ­£ç¢ºçš„é‚è¼¯ä¿®æ­£å¦‚ä¸‹ (ä½¿ç”¨æ¨™æº–çš„å¾å·¦åˆ°å³éæ­·)ï¼š***

        int result = 0;
        for (int i = 0; i < s.length(); i++) {
            int current = helper(s[i]);

            // æª¢æŸ¥ä¸‹ä¸€å€‹æ•¸å­—æ˜¯å¦å­˜åœ¨
            if (i + 1 < s.length()) {
                int next = helper(s[i+1]);

                // åˆ¤æ–·æ˜¯å¦ç‚ºæ¸›æ³•è¦å‰‡ (ç•¶å‰å€¼ < ä¸‹ä¸€å€‹å€¼)
                if (current < next) {
                    result -= current; // é‡åˆ° IV æˆ– IX ç­‰ï¼Œç•¶å‰å€¼æ‡‰è©²æ¸›å»
                } else {
                    result += current; // å¦å‰‡åŠ ä¸Šç•¶å‰å€¼
                }
            } else {
                // è™•ç†æœ€å¾Œä¸€å€‹å­—å…ƒï¼Œå®ƒå‰é¢æ²’æœ‰æ•¸å­—ä¾†å½±éŸ¿å®ƒçš„åŠ æ¸›
                result += current;
            }
        }

        return result; // è¿”å›ä¿®æ­£å¾Œçš„æ­£ç¢ºçµæœ
    }
};
